<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">
  <title>统一启动器</title>
  <meta name="description" content="统一启动器 - 快速访问各种服务">
  <meta name="theme-color" content="#667eea">
  <link rel="manifest" href="manifest.json">
  <script src="pwa.js"></script>
  <link rel="stylesheet" href="index.css">
  <!-- iOS PWA支持 -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="统一启动器">
  <link rel="apple-touch-icon" href="icons/icon.png">
  <!-- Android PWA增强支持 -->
  <link rel="icon" href="icons/icon.png" type="image/png">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="application-name" content="统一启动器">
</head>
<body>
<!-- 主要内容容器 - 液态玻璃效果 -->
<div class="glass-container">
  <div class="welcome">
<div class="header-flex" style="display: flex; align-items: center; justify-content: center; gap: 1rem;">
  <img src="icons/icon.png" alt="统一启动器图标" width="128" height="128">
  <h1>统一启动器</h1>
</div>
    <p>请选择一个服务开始</p>
  </div>

  <div class="button-group main">
    <a class="btn primary" href="http://192.168.0.197:3010">记账</a>
    <a class="btn primary" href="#" onclick="checkCountryAndRedirect(event, 'http://192.168.0.197:3000')">记账国际版HFM</a>
    <a class="btn primary" href="http://192.168.0.197:3100">金流</a>
    <a class="btn primary" href="http://192.168.0.197:5000">库存</a>
  </div>
</div>

<!-- 其他服务容器 - 液态玻璃效果 -->
<div class="glass-container">
  <div class="extras">
    <h2>其他临时服务</h2>
    <div class="button-group secondary">
      <a class="btn secondary" href="http://192.168.0.197:8200">收入</a>
      <a class="btn secondary" href="http://192.168.0.197:8100">金流充值</a>
    </div>
  </div>
</div>

<!-- 工具容器 - 液态玻璃效果 -->
<div class="glass-container">
  <div class="button-group primary">
    <button class="btn primary" id="check-compatibility" onclick="window.location.href='./component/compatibility-check/browser.html'">检查兼容性</button>
    <button class="btn primary" id="rate" onclick="window.location.href='./component/exchange-rate/rate.html'">汇率计算器</button>
  </div>
</div>

<div>
  <br>
  <small id="user-agent"></small>
</div>

<!-- PWA安装提示 - 液态玻璃风格 -->
<div id="installPrompt" class="install-prompt" style="display: none; position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: var(--install-bg, rgba(44, 62, 80, 0.9)); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); color: var(--install-text, #fff); padding: 1.5rem; border-radius: 16px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 8px 32px rgba(0,0,0,0.2); z-index: 9999; min-width: 300px; max-width: 90vw; transition: all 0.3s ease;">
  <h3 style="margin: 0 0 10px 0; font-size: 1.2rem; text-shadow: 0 2px 4px rgba(0,0,0,0.1);">安装统一启动器</h3>
  <p style="margin: 0 0 15px 0; opacity: 0.9; line-height: 1.5;">将此应用安装到您的桌面或移动设备，获得更好的体验</p>
  <div style="display: flex; gap: 12px; justify-content: flex-end; flex-wrap: wrap;">
    <button id="closeInstallBtn" style="background: rgba(255,255,255,0.1); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); color: inherit; border: 1px solid rgba(255,255,255,0.2); padding: 10px 20px; border-radius: 8px; cursor: pointer; transition: all 0.3s ease; font-weight: 500;">稍后</button>
    <button id="installBtn" style="background: linear-gradient(135deg, #b8e0ff 0%, #7f5af0 100%); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);">立即安装</button>
  </div>
</div>

<!-- Safari安装指南固定显示在底部 - 液态玻璃风格 -->
<div class="safari-install-guide" style="position: fixed; bottom: 0; left: 0; right: 0; background: var(--install-guide-bg, rgba(240, 240, 240, 0.9)); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); color: var(--install-guide-text, #333); padding: 1rem; text-align: center; font-size: 0.9rem; z-index: 999; border-top: 1px solid var(--install-guide-border, rgba(221, 221, 221, 0.8)); box-shadow: 0 -2px 15px rgba(0,0,0,0.05); transition: all 0.3s ease;">
  <p style="margin: 0; display: flex; align-items: center; justify-content: center; gap: 8px; font-weight: 500;">
    <span>Safari用户: 点击分享按钮 → 添加到主屏幕</span>
  </p>
</div>

<!-- 自定义弹窗HTML结构 -->
<div id="customModal" class="custom-modal">
  <div class="custom-modal-content">
    <div class="custom-modal-header">
      <h3 class="custom-modal-title" id="modalTitle">提示</h3>
    </div>
    <div class="custom-modal-body">
      <p id="modalMessage">消息内容</p>
    </div>
    <div class="custom-modal-footer">
      <button id="modalCloseBtn" class="custom-modal-button">确定</button>
    </div>
  </div>
</div>

<script>
  
  document.getElementById('user-agent').textContent = navigator.userAgent;
  
  // 自定义弹窗函数
  function showModal(title, message) {
    const modal = document.getElementById('customModal');
    const modalTitle = document.getElementById('modalTitle');
    const modalMessage = document.getElementById('modalMessage');
    const modalCloseBtn = document.getElementById('modalCloseBtn');
    
    // 确保弹窗元素存在
    if (!modal || !modalTitle || !modalMessage || !modalCloseBtn) {
      console.error('弹窗元素未找到');
      return;
    }
    
    // 设置弹窗内容
    modalTitle.textContent = title || '提示';
    modalMessage.textContent = message || '';
    
    // 重置状态
    modal.style.display = 'flex';
    modal.classList.remove('hide', 'show');
    
    // 防止背景滚动
    document.body.style.overflow = 'hidden';
    
    // 强制重排，确保过渡效果能正确触发
    void modal.offsetWidth;
    
    // 添加显示类
    modal.classList.add('show');
    
    // 关闭弹窗的通用函数
    function closeModal() {
      // 添加隐藏类
      modal.classList.remove('show');
      modal.classList.add('hide');
      
      // 动画完成后恢复背景滚动和隐藏弹窗
      setTimeout(() => {
        modal.style.display = 'none';
        document.body.style.overflow = '';
      }, 300); // 与CSS过渡时间一致
    }
    
    // 关闭按钮事件
    modalCloseBtn.onclick = function() {
      closeModal();
    };
    
    // 点击背景关闭弹窗
    modal.onclick = function(event) {
      if (event.target === modal) {
        closeModal();
      }
    };
    
    // 按ESC键关闭弹窗
    document.addEventListener('keydown', function escHandler(event) {
      if (event.key === 'Escape') {
        closeModal();
        document.removeEventListener('keydown', escHandler);
      }
    });
  }

  // IP地理位置检查函数
  async function checkCountryAndRedirect(event, targetUrl) {
    event.preventDefault();
    
    try {
      // 使用ipapi.co API获取IP信息
      const response = await fetch('https://ipapi.co/json/');
      const data = await response.json();
      
      // 检查是否为中国大陆
      if (data.country === 'CN') {
        showModal('地区限制', '您所在国家或地区不受支持');
      } else {
        // 非中国大陆用户可以访问
        window.location.href = targetUrl;
      }
    } catch (error) {
      console.error('IP检查失败:', error);
      showModal('地区限制', '您所在国家或地区不受支持');
    }
  }

  // 处理快捷方式URL参数
  function handleShortcuts() {
    const urlParams = new URLSearchParams(window.location.search);
    const app = urlParams.get('app');
    
    if (app === 'homemoney') {
      window.open('http://192.168.0.197:3010', '_blank');
    } else if (app === 'chrysorrhoe') {
      window.open('http://192.168.0.197:3100', '_blank');
    } else if (app === 'inventory') {
      window.open('http://192.168.0.197:5000', '_blank');
    }
  }
</script>
